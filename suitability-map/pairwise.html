<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pairwise Comparison - Fuzzy AHP</title>
<style>
  body { font-family: sans-serif; text-align: center; margin: 0; padding: 20px; }
  table { margin: auto; border-collapse: collapse; width: 90%; }
  th, td { border: 1px solid #ccc; padding: 6px 12px; text-align: center; }
  th { background: #f0f0f0; }
  select { width: 100px; }
  #results { margin-top: 20px; }
</style>
</head>
<body>
<h1>Pairwise Comparison - Fuzzy AHP</h1>
<p>Use the dropdowns to compare each pair of criteria.</p>

<table id="pairwiseTable">
  <thead>
    <tr>
      <th>Criterion A</th>
      <th>Importance</th>
      <th>Criterion B</th>
    </tr>
  </thead>
  <tbody>
    <!-- Rows generated by JS -->
  </tbody>
</table>

<button id="computeBtn">Compute Normalized Weights</button>

<div id="results">
  <h2>Normalized Weights</h2>
  <ul id="weightsList"></ul>
</div>

<script>
// --- Your criteria
const variables = [
  "logistics",
  "energy cost",
  "energy carbon intensity",
  "proximity to acid disposal",
  "oceanic conditions",
  "potential for brine",
  "distance from the coast"
];

// --- 17-point fuzzy TFNs [lower, middle, upper]
const fuzzy17TFN = {
  "1/9": [1/9,1/9,1/8], "1/8": [1/8,1/8,1/7], "1/7": [1/7,1/7,1/6],
  "1/6": [1/6,1/6,1/5], "1/5": [1/5,1/5,1/4], "1/4": [1/4,1/4,1/3],
  "1/3": [1/3,1/3,1/2], "1/2": [1/2,1/2,1], "1": [1,1,1],
  "2": [1,2,3], "3": [2,3,4], "4": [3,4,5], "5": [4,5,6],
  "6": [5,6,7], "7": [6,7,8], "8": [7,8,9], "9": [8,9,9]
};

// --- Generate options HTML
function generate17Options() {
  return Object.keys(fuzzy17TFN).map(k => `<option value="${k}" ${k==="1"?'selected':''}>${k}</option>`).join('');
}

// --- Reciprocal of a TFN
function reciprocalTFN(tfn) {
  return [1/tfn[2], 1/tfn[1], 1/tfn[0]];
}

// --- Generate table rows
const tbody = document.querySelector("#pairwiseTable tbody");
for(let i=0;i<variables.length;i++){
  for(let j=i+1;j<variables.length;j++){
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${variables[i]}</td>
      <td><select data-i="${i}" data-j="${j}">${generate17Options()}</select></td>
      <td>${variables[j]}</td>
    `;
    tbody.appendChild(tr);
  }
}

// --- Compute normalized weights ---
document.getElementById("computeBtn").addEventListener("click", ()=>{
  const n = variables.length;
  // initialize fuzzy pairwise matrix
  const matrix = Array.from({length:n}, ()=>Array(n).fill([1,1,1]));

  // fill matrix from table
  document.querySelectorAll("#pairwiseTable select").forEach(sel=>{
    const i = parseInt(sel.dataset.i);
    const j = parseInt(sel.dataset.j);
    const val = sel.value;
    const tfn = fuzzy17TFN[val];
    matrix[i][j] = tfn;
    matrix[j][i] = reciprocalTFN(tfn);
  });

  // compute approximate normalized weights using geometric mean method
  const geomMeans = [];
  for(let i=0;i<n;i++){
    let l=1,m=1,u=1;
    for(let j=0;j<n;j++){
      l*=matrix[i][j][0];
      m*=matrix[i][j][1];
      u*=matrix[i][j][2];
    }
    geomMeans.push([Math.pow(l,1/n), Math.pow(m,1/n), Math.pow(u,1/n)]);
  }

  // normalize
  const sumL = geomMeans.reduce((a,b)=>a+b[0],0);
  const sumM = geomMeans.reduce((a,b)=>a+b[1],0);
  const sumU = geomMeans.reduce((a,b)=>a+b[2],0);

  const normalized = geomMeans.map(([l,m,u])=>[l/sumL, m/sumM, u/sumU]);

  // defuzzify using (l+m+u)/3
  const defuzzified = normalized.map(([l,m,u])=>(l+m+u)/3);

  // display results
  const ul = document.getElementById("weightsList");
  ul.innerHTML = "";
  variables.forEach((v,i)=>{
    const w = defuzzified[i].toFixed(3);
    const li = document.createElement("li");
    li.textContent = `${v}: ${w}`;
    ul.appendChild(li);
  });
});
</script>
</body>
</html>
